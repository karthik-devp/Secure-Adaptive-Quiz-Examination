{% extends 'base.html' %}
{% block title %}{{ 'Edit Quiz' if quiz else 'Create Quiz' }} - QuizEngine{% endblock %}
{% block content %}
<div class="dashboard">
    <div class="page-header">
        <h1><i class="fas fa-{% if quiz %}edit{% else %}plus-circle{% endif %}"></i> {{ 'Edit Quiz' if quiz else 'Create
            New Quiz' }}</h1>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back</a>
    </div>

    <!-- Quiz Details Form -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fas fa-info-circle"></i> Quiz Details</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('edit_quiz', quiz_id=quiz.id) if quiz else url_for('create_quiz') }}"
                class="form-inline-grid">
                <div class="form-group">
                    <label for="title">Quiz Title</label>
                    <input type="text" id="title" name="title" value="{{ quiz.title if quiz else '' }}" required
                        placeholder="e.g. Python Fundamentals">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="total_marks">Total Marks</label>
                        <input type="number" id="total_marks" name="total_marks"
                            value="{{ quiz.total_marks if quiz else 0 }}" min="0">
                    </div>
                    <div class="form-group">
                        <label for="time_limit">Time Limit (minutes)</label>
                        <input type="number" id="time_limit" name="time_limit"
                            value="{{ quiz.time_limit if quiz else 30 }}" min="1">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> {{ 'Update Quiz' if quiz else
                    'Create Quiz' }}</button>
            </form>
        </div>
    </div>

    {% if quiz %}
    <!-- Add Question Form -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fas fa-plus-circle"></i> Add Question</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('add_question', quiz_id=quiz.id) }}">
                <div class="form-group">
                    <label for="question_text">Question</label>
                    <textarea id="question_text" name="question_text" rows="3" required
                        placeholder="Enter your question here..."></textarea>
                </div>
                <div class="form-row form-row-4">
                    <div class="form-group">
                        <label for="option1">Option A</label>
                        <input type="text" id="option1" name="option1" required placeholder="Option A">
                    </div>
                    <div class="form-group">
                        <label for="option2">Option B</label>
                        <input type="text" id="option2" name="option2" required placeholder="Option B">
                    </div>
                    <div class="form-group">
                        <label for="option3">Option C</label>
                        <input type="text" id="option3" name="option3" required placeholder="Option C">
                    </div>
                    <div class="form-group">
                        <label for="option4">Option D</label>
                        <input type="text" id="option4" name="option4" required placeholder="Option D">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="correct_answer">Correct Answer</label>
                        <input type="text" id="correct_answer" name="correct_answer" required
                            placeholder="Exact match with option">
                    </div>
                    <div class="form-group">
                        <label for="difficulty">Difficulty</label>
                        <select id="difficulty" name="difficulty">
                            <option value="easy">ðŸŸ¢ Easy</option>
                            <option value="medium" selected>ðŸŸ¡ Medium</option>
                            <option value="hard">ðŸ”´ Hard</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="marks">Marks</label>
                        <input type="number" id="marks" name="marks" value="2" min="1" max="10">
                    </div>
                </div>
                <button type="submit" class="btn btn-success"><i class="fas fa-plus"></i> Add Question</button>
            </form>
        </div>
    </div>

    <!-- Existing Questions -->
    <div class="card">
        <div class="card-header">
            <h2><i class="fas fa-list"></i> Questions ({{ questions|length }})</h2>
        </div>
        <div class="card-body">
            {% if questions %}
            <div class="question-list">
                {% for q in questions %}
                <div class="question-item">
                    <div class="question-header">
                        <span class="question-number">Q{{ loop.index }}</span>
                        <span class="badge badge-{{ q.difficulty }}">{{ q.difficulty|capitalize }}</span>
                        <span class="badge badge-marks">{{ q.marks }} marks</span>
                        <form method="POST" action="{{ url_for('delete_question', question_id=q.id) }}"
                            style="display:inline; margin-left:auto">
                            <button class="btn btn-sm btn-danger" onclick="return confirm('Delete this question?')"><i
                                    class="fas fa-trash"></i></button>
                        </form>
                    </div>
                    <p class="question-text">{{ q.question_text }}</p>
                    <div class="options-grid">
                        <span class="option {% if q.option1 == q.correct_answer %}option-correct{% endif %}">A. {{
                            q.option1 }}</span>
                        <span class="option {% if q.option2 == q.correct_answer %}option-correct{% endif %}">B. {{
                            q.option2 }}</span>
                        <span class="option {% if q.option3 == q.correct_answer %}option-correct{% endif %}">C. {{
                            q.option3 }}</span>
                        <span class="option {% if q.option4 == q.correct_answer %}option-correct{% endif %}">D. {{
                            q.option4 }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-question-circle"></i>
                <p>No questions added yet. Use the form above to add questions.</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}